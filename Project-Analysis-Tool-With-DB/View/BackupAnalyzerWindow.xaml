<Window x:Class="SpAnalyzerTool.View.BackupAnalyzerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SpAnalyzerTool.View"
        xmlns:converters="clr-namespace:SpAnalyzerTool.Converter"
        mc:Ignorable="d"
        Title=".bak File تحليل بأستخدام"
        Height="700"
        Width="1000"
        WindowStartupLocation="CenterScreen"
        Background="WhiteSmoke">

    <Window.Resources>
        <converters:LocationDisplayConverter x:Key="LocationDisplayConverter"/>
        <Style TargetType="Button" BasedOn="{StaticResource PrimaryButton}"/>
        <Style TargetType="TextBlock" BasedOn="{StaticResource HeaderTextBlock}"/>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- اختيار ملف الباك أب -->

        <GroupBox Header ="📄 .bak File" FontSize="16" FontWeight="Bold" Grid.Row="0" Margin="0,0,0,5">
            <StackPanel  Margin="5">
            <DockPanel>
                <TextBox x:Name="txtBackupPath" Width="600" Height="30" Margin="0,5,10,0"/>
                <Button Content="📁 استعراض" Width="100" Click="BrowseBackup_Click" />
            </DockPanel>
            <TextBlock x:Name="txtBackupSize" Foreground="DarkGreen" HorizontalAlignment="Left"></TextBlock>

        </StackPanel>
        </GroupBox>

        <!-- اختيار مجلد المشروع -->
        <GroupBox Header="📁 مجلد المشروع" FontSize="16" FontWeight="Bold" Grid.Row="1" Margin="0,0,0,15">
            <StackPanel Margin="5">
                <DockPanel>
                    <TextBox  Text="{Binding ProjectPath , Mode=TwoWay}" Width="600" Height="30" FontSize="12" Margin="0,0,5,0"/>
                    <Button Content="📁 استعراض" Width="120" Click="BrowseProject_Click"/>
                </DockPanel>
                <TextBlock x:Name="txtProjectSize" Foreground="DarkGreen"></TextBlock>
            </StackPanel>
        </GroupBox>

        
        <!-- زر التحليل -->
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Grid.Row="2" Margin="0,0,0,10">
            <Button Content="🔍 تحليل الملف" Width="190" Height="35" Click="AnalyzeBackup_Click" FontWeight="DemiBold"/>
            <Button Visibility="Collapsed" Content="🗑️ حذف الإجراءات غير المستخدمة"  Width="250" Height="35" Margin="10,10,0,10" FontWeight="DemiBold" />

        </StackPanel>
        <TextBlock x:Name="txtStatus"
           Grid.Row="2"
           Margin="10,50,0,0"
           Foreground="DarkOrange"
           FontWeight="Bold"
            Visibility="Collapsed"
           Text="🔄 جاري التحليل، يرجى الانتظار..." />

        <Grid  Grid.Row="3" Margin="0,0,0,10" x:Name="grdUC" Visibility="Collapsed" >
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="auto"/>
            </Grid.RowDefinitions>


            <DataGrid  x:Name="dgv"    
           Style="{StaticResource StyledDataGrid}"
           ItemsSource="{Binding ObProject}"
           SelectedItem="{Binding SelectedProcedure, Mode=TwoWay}"
           AutoGenerateColumns="False"
           HeadersVisibility="Column"
           CanUserAddRows="False"
           CanUserDeleteRows="False"
           FontFamily="Consolas"
           FontSize="14"
           Margin="0,10,0,10"
           IsReadOnly="True">
                <DataGrid.Columns>



                    <!-- اسم البروسيجر -->
                    <DataGridTextColumn Header="اسم البروسيجر" Binding="{Binding Procedure}" Width="200"/>

                    <!-- العدد -->
                    <DataGridTextColumn Header="العدد" Binding="{Binding Count}" Width="50"/>

                    <!-- الحالة -->
                    <DataGridTextColumn Header="الحالة" Binding="{Binding Status}" Width="130">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Status}" Value="❌ غير مستخدم">
                                        <Setter Property="Foreground" Value="Red"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <!-- ✅ المواقع -->
                    <DataGridTemplateColumn Header="المواقع" Width="400">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ItemsControl ItemsSource="{Binding LocationPaths}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock 
                       Text="{Binding Path=., Converter={StaticResource LocationDisplayConverter}}" 
                       Foreground="Blue"
                       TextDecorations="Underline"
                       Cursor="Hand"
                       Margin="0,0,5,0">
                                                <TextBlock.InputBindings>
                                                    <MouseBinding Gesture="LeftClick"
                               Command="{Binding DataContext.OpenLocationInEditorCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                               CommandParameter="{Binding}" />
                                                </TextBlock.InputBindings>
                                            </TextBlock>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>


                    <!-- ✅ تحديد للحذف + تعديل -->
                    <DataGridTemplateColumn Width="230" Visibility="Collapsed">
                        <DataGridTemplateColumn.Header>
                            <CheckBox Content="تحديد الكل" Foreground="White"  ToolTip="تحديد الكل" Style="{StaticResource DataGridCheckBoxStyle}"
                                 Click="CheckBox_Click"
    />
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center"
                                   Margin="5">
                                    <CheckBox IsChecked="{Binding IsSelectedForDelete, Mode=TwoWay}" Margin="0,0,15,0" Style="{StaticResource DataGridCheckBoxStyle}"  />
                                    <Button Content="📝" Style="{StaticResource DataGridButtonStyle}" 
                       ToolTip="تعديل الإجراء"
                       
                       Command="{Binding DataContext.EditProcedureEditorCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                       CommandParameter="{Binding}" />
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                </DataGrid.Columns>
            </DataGrid>

            <!-- StackPanel للملخص -->
            <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,5,10,5">
                <TextBlock Text="{Binding TotalCount}" Margin="0,0,0,0" FontWeight="Bold"/>
                <TextBlock Text=" : العدد الإجمالي" Margin="5,0,0,0"/>

                <TextBlock Text="{Binding UsedCount}" Margin="15,0,0,0" Foreground="Green" FontWeight="Bold"/>
                <TextBlock Text=" : المستخدم" Margin="5,0,0,0"/>

                <TextBlock Text="{Binding  UnusedCount}" Margin="15,0,0,0" Foreground="Red" FontWeight="Bold"/>
                <TextBlock Text=" : غير مستخدم"/>
            </StackPanel>

            <!-- زر التصدير -->
            <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                <Button Content="📄 تصدير النتائج" Width="400"
     Style="{StaticResource PrimaryButton}"
     Command="{Binding ExportResultsCommand}"/>
            </StackPanel>


        </Grid>

    </Grid>

</Window>
